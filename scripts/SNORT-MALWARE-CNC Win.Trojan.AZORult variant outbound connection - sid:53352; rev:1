# SNORT:SNORT-MALWARE-CNC Win.Trojan.AZORult variant outbound connection - sid:53352; rev:1

# Note: In order for this rule to work, "User-Agent", both "Content" headers and both "Accept" headers needed to be deprecated.
# This may trigger 2 SNORT http_inspect warnings, "UNKNOWN METHOD" and "POST W/O CONTENT-LENGTH OR CHUNKS"
# The http_inspect warnings appear to be triggered specifically by the removal of the 2 "Content" headers

Name "SNORT-MALWARE-CNC Win.Trojan.AZORult variant outbound connection - sid:53352; rev:1"

msg 1, INITIATOR->TARGET {
  
  "POST /As/MT-209111.jpg HTTP/1.1"  0x0D 0x0A
# "Content-Type: text/plain"  0x0D 0x0A
# "User-Agent: FirebindRecon/2.0.0"  0x0D 0x0A
# "Accept: */*"  0x0D 0x0A
  "Host: firebind.com"  0x0D 0x0A
# "Accept-Encoding: gzip, deflate, br"  0x0D 0x0A
  "Connection: keep-alive"  0x0D 0x0A
# "Content-Length: 45"  0x0D 0x0A
  0x0D 0x0A
  "Firebind CNC test outbound" 0x0D 0x0A
  $(GUID.TXT) 0x0D 0x0A
 
}

# return trip 
msg 2, INITIATOR<-TARGET {
  
  "HTTP/1.1 200 OK"  0x0D 0x0A
  "Access-Control-Allow-Origin: *"  0x0D 0x0A
  "Content-Type: text/html; charset=utf-8"  0x0D 0x0A
  "X-Cloud-Trace-Context: aef9a6cbfa25423b3dcd94a5223bb8ab"  0x0D 0x0A
  "Date: Mon, 20 Apr 2020 20:47:28 GMT"  0x0D 0x0A
  "Server: Google Frontend"  0x0D 0x0A
  "Content-Length: 54"  0x0D 0x0A
  0x0D 0x0A
  "Firebind CNC test inbound" 0x0D 0x0A
  $(GUID.TXT) 0x0D 0x0A
    
}


# This script created for use with Firebind Recon - www.firebind.com
# Copyright (C) 2020 Firebind Inc. All rights reserved
